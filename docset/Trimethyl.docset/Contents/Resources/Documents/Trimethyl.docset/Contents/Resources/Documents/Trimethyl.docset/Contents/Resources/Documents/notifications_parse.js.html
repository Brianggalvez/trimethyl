<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: notifications/parse.js</title>
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main" class="nonav">

    <h1 class="page-title">Source: notifications/parse.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module  notifications/parse
 * @author  Flavio De Stefano &lt;flavio.destefano@caffeinalab.com>
 */

var HTTP = require('T/http');

var app_id = Ti.App.Properties.getString('parse.appid');
var client_key = Ti.App.Properties.getString('parse.clientkey');
var gcm_sender_id = Ti.App.Properties.getString('gcm.senderid');

var app_base = {
	appName: Ti.App.name,
	appVersion: Ti.App.version,
	appIdentifier: Ti.App.id
};

exports.subscribe = function(opt) {
	if (app_id == null) {
		Ti.API.error("Notifications.Parse: Invalid Parse application ID. Set it in your tiapp.xml");
		throw new Error({ message: "Invalid Parse application ID" });
	}
	if (client_key == null) {
		Ti.API.error("Notifications.Parse: Invalid Client API key. Set it in your tiapp.xml");
		throw new Error({ message: "Invalid Client API key" });
	}
	if (OS_ANDROID) {
		if (gcm_sender_id == null) {
			Ti.API.error("Notifications.Parse: Invalid GCM sender ID. Set it in your tiapp.xml");
			throw new Error({ message: "Invalid GCM sender ID." });
		}
	}

	HTTP.send({
		url: 'https://api.parse.com/1/installations',
		method: 'POST',
		headers: {
			'X-Parse-Application-Id': app_id,
			'X-Parse-Client-Key': client_key,
			'Content-Type': 'application/json'
		},
		data: JSON.stringify((function() {
			if (OS_IOS) {
				return _.extend({
					deviceType: 'ios',
					deviceToken: opt.deviceToken,
					channels: [ opt.channel || "" ],
				}, app_base);
			} else if (OS_ANDROID) {
				return _.extend({
					deviceType: 'android',
					pushType: 'gcm',
					deviceToken: opt.deviceToken,
					GCMSenderId: gcm_sender_id,
					channels: [ opt.channel || "" ],
				}, app_base);
			}
		})()),
		success: opt.success,
		error: opt.error,
		errorAlert: false,
		silent: true
	});
};

exports.unsubscribe = function(opt) {
	if (app_id == null) {
		Ti.API.error("Notifications.Parse: Invalid Parse application ID. Set it in your tiapp.xml");
		throw new Error({ message: "Invalid Parse application ID" });
	}
	if (client_key == null) {
		Ti.API.error("Notifications.Parse: Invalid Client API key. Set it in your tiapp.xml");
		throw new Error({ message: "Invalid Client API key" });
	}
	if (OS_ANDROID) {
		if (gcm_sender_id == null) {
			Ti.API.error("Notifications.Parse: Invalid GCM sender ID. Set it in your tiapp.xml");
			throw new Error({ message: "Invalid GCM sender ID." });
		}
	}

	HTTP.send({
		url: 'https://api.parse.com/1/installations',
		method: 'DELETE',
		headers: {
			'X-Parse-Application-Id': app_id,
			'X-Parse-Client-Key': client_key,
			'Content-Type': 'application/json'
		},
		data: JSON.stringify((function() {
			if (OS_IOS) {
				return _.extend({
					deviceType: 'ios',
					deviceToken: opt.deviceToken,
					channels: [ opt.channel || "" ],
				}, app_base);
			} else if (OS_ANDROID) {
				return _.extend({
					deviceType: 'android',
					pushType: 'gcm',
					deviceToken: opt.deviceToken,
					GCMSenderId: gcm_sender_id,
					channels: [ opt.channel || "" ],
				}, app_base);
			}
		})()),
		success: opt.success,
		error: opt.error,
		errorAlert: false,
		silent: true
	});
};</code></pre>
        </article>
    </section>




</div>



<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
